# Transaction
## 트랜잭션이란
- transaction 이라는 단어는 거래를 뜻하는데, 데이터베이스 등에서 사용되는 쪼갤 수 없는 업무의 단위를 뜻한다.
- 돈을 줬는데 물건을 받지 못하면, 그 거래는 이루어지지 않고 원상 복구되어야 한다. 이와 같이 쪼갤 수 없는 하나의 처리 행위를 원자적 행위 라고 한다.
- 여기서 쪼갠다는 의미는 실제로 쪼갤 수 없다는 뜻 보다는, 쪼개질 경우 시스템에 심각한 오류를 초래할 수 있다는 것이다.

## 트랜잭션 ACID
### Atomic (원자성)
- 트랜잭션의 처리는 완전히 끝마치지 않은경우, 전혀 이루어지지 않은 것과 같아야 한다.
- 트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장한다 . 
### Consistency (일관성)
- 트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것을 의미한다.
- 여기서 말하는 일관성이란, 위의 거래 예제에서 금액의 데이터 타입이 정수형(integer)인데, 갑자기 문자열(string)이 되지 않는 것을 말합니다.
### Isolation (독립성)
- 트랜잭션의 부분적인 상태를 다른 트랜잭션에 제공해서는 안 된다.
- 트랜잭션을 수행 시 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장하는 것을 의미한다. 
- 이것은 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없음을 의미한다. 
### Durability (지속성)
- 성공적인 트랜잭션 수행 후에는 반드시 데이터베이스에 반영 되어야 한다.
- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 함을 의미한다.


---

## 격리레벨
한 트랜잭션에서 데이터의 상태를 변경했을 떄, 동시에 실행되는 다른 트랜젝션에 변경된 상태를 공유할지 말지 또, 공유를 한다면 어느정도 수준까지 공유할 지를 설정하는 것.

### Dirty read
commit 을 하지 않더라도 다른 트랜잭션에 영향을 미침

### NonRepeatable read
update, delete 쿼리의 경우 commit 을 한 이후에 다른 트랜잭션에 영향을 미침

### Phantom read
insert 쿼리의 경우 commit 을 한 이후 다른 트랜젝션에 영향을 미침


|Isolation level|Dirty read|NonRepeatable read|Phantom read|
|---|:---:|:---:|:---:|
|Read uncommitted|O|O|O|
|Read committed|X|O|O|
|Repeatable read|X|X|O|
|Serializable|X|X|X|

디폴트는 read committed 이며, MySQL 에서는 Repeatable read 가 디폴트다.

### 정리
#### Read uncommitted
다른 트랜잭션에서 커밋하지 않더라도 그 결과가 반영되어 조회가 가능하다.

#### Read committed
다른 트랜잭션에서 insert, update, delete 한 건에 대해 커밋한 경우에만 조회가 가능하다.

#### Repeatable read
다른 트랜잭션에서 insert 하고 커밋한 경우에만 조회 가능

#### Serializable
다른 트랜잭션에서 무얼하던 조회 할 수 없다. 하나의 트랜잭션이 완료된 이후 다른 트랜잭션이 실행하는 것처럼 지원하며, 높은 비용을 요구한다.